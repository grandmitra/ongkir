<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Logistik Pro - Sofyan Mujid</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .header-card { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .result-box { background: #1a1a1a; color: #00d2ff; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; }
        .btn-export { min-width: 120px; }
        .btn-gmaps { background-color: #4285F4; color: white; font-weight: bold; border-radius: 8px; }
        .btn-gmaps:hover { background-color: #357ae8; color: white; }
        .status-ideal { color: #198754; font-weight: bold; }
        .status-warning { color: #fd7e14; font-weight: bold; }
        .status-inefficient { color: #dc3545; font-weight: bold; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="header-card text-center">
        <h2><i class="fas fa-truck-loading me-2"></i> Kalkulator Logistik & Ongkir</h2>
        <p>Sistem Estimasi Muatan & Jarak Jabodetabek</p>
        <div class="mt-3 no-print">
            <button class="btn btn-danger btn-export me-2" onclick="exportToPDF()">
                <i class="fas fa-file-pdf me-1"></i> PDF
            </button>
            <button class="btn btn-success btn-export" onclick="exportToExcel()">
                <i class="fas fa-file-excel me-1"></i> Excel
            </button>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Daftar Muatan</h5>
                    <div class="no-print">
                        <button class="btn btn-sm btn-outline-danger me-2" onclick="resetCalculator()"><i class="fas fa-sync"></i> Reset</button>
                        <button class="btn btn-sm btn-primary" onclick="addRow()"><i class="fas fa-plus"></i> Tambah Item</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table align-middle mb-0" id="tonaseTable">
                        <thead>
                            <tr>
                                <th>Item Material</th>
                                <th class="text-center">Berat/Vol</th>
                                <th class="text-center" style="width: 100px;">Qty</th>
                                <th class="text-end">Total Beban</th>
                                <th class="no-print"></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card p-3 shadow-sm mb-3">
                <h6 class="fw-bold"><i class="fas fa-route me-2"></i>Parameter Pengiriman</h6>
                <hr>
                
                <div class="d-grid mb-3">
                    <a href="https://www.google.com/maps/dir/''/Jl.+Senopati,+Kec.+Kby.+Baru,+Kota+Jakarta+Selatan,+Daerah+Khusus+Ibukota+Jakarta/@-6.1488659,106.671165,27025m/data=!3m1!1e3!4m14!4m13!1m5!1m1!1s0x2e6a03fc6a46f3cd:0x869e7566d672b37e!2m2!1d106.7076702!2d-6.0682105!1m5!1m1!1s0x2e69f15b30d89e2f:0x36d3e4c4cc53ad68!2m2!1d106.8067515!2d-6.2302352!3e0?hl=en-US&entry=ttu&g_ep=EgoyMDI2MDExMy4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" target="_blank" class="btn btn-gmaps">
                        <i class="fas fa-map-marked-alt me-2"></i> CEK RUTE GMAPS (PIK 2)
                    </a>
                    <small class="text-center text-muted mt-1" style="font-size: 0.75rem;">Hitung estimasi jarak ke lokasi tujuan</small>
                </div>

                <div class="mb-2">
                    <label class="small fw-bold">Jarak Tempuh (KM):</label>
                    <input type="number" id="jarakKm" class="form-control" value="10" oninput="calculateTotal()">
                </div>
                <div class="mb-2">
                    <label class="small fw-bold">Biaya Tol PP (Rp):</label>
                    <input type="number" id="biayaTol" class="form-control" value="0" oninput="calculateTotal()">
                </div>
                <div class="mb-3">
                    <label class="small fw-bold">Biaya Kuli (Rp):</label>
                    <input type="number" id="biayaKuli" class="form-control" value="0" oninput="calculateTotal()">
                </div>
                
                <div class="result-box mb-2">
                    <div class="small text-white opacity-75">Total Muatan:</div>
                    <span id="totalTonDisplay">0.00</span> Ton | <span id="totalM3Display">0.00</span> m³
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mt-2">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-truck me-2"></i>Simulasi Kendaraan & Estimasi Ongkir</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-bordered table-hover align-middle mb-0">
                <thead class="table-light text-center">
                    <tr>
                        <th>Jenis Armada</th>
                        <th>Kapasitas</th>
                        <th>Jml Trip</th>
                        <th>Total Biaya</th>
                        <th>Efisiensi</th>
                    </tr>
                </thead>
                <tbody id="analysisBody"></tbody>
            </table>
        </div>
    </div>
</div>

<footer class="text-center py-4 text-muted small">
    © 2026 Kalkulator Logistik Material - Standard Jabodetabek
</footer>

<script>
    // Database Material Hasil Konversi [Berat(kg), Kubikasi(m3)]
    const materials = new Map([
        ["Pilih Item", [0, 0]],
        ["TEHEL 25X25 UNO", [15, 0.02]],
        ["TEHEL 25X25 MASS", [15, 0.02]],
        ["TEHEL 25X40 UNO", [15, 0.02]],
        ["TEHEL 25X40 MASS", [16, 0.02]],
        ["TEHEL 25X50 UNO", [16, 0.02]],
        ["TEHEL 30X60 UNO", [17, 0.03]],
        ["TEHEL 40X40 ARW", [17, 0.02]],
        ["TEHEL 40X40 MASS", [17, 0.02]],
        ["TEHEL 40X40 SPECTRUM", [16, 0.02]],
        ["TEHEL 50X50 LAGUNA", [20, 0.03]],
        ["TEHEL 50X50 UNO", [19, 0.03]],
        ["TEHEL 60X60 MASS", [28, 0.04]],
        ["TEHEL 60X60 UMUM", [30, 0.04]],
        ["GRANIT 60X60 GRACE", [21, 0.04]],
        ["GRANIT 60X60 MOTIF", [28, 0.04]],
        ["GRANIT 80X80", [44, 0.06]],
        ["GRANIT 120X60", [34, 0.05]],
        ["GRANIT 60X60 MAGIA", [32, 0.04]],
        ["GRANIT 60X60 MAGIA2", [28, 0.04]],
        ["TEHEL 20X40", [16, 0.02]],
        ["BESI 6 SNI", [3, 0.005]],
        ["BESI 8 SNI", [5, 0.006]],
        ["BESI 10 SNI", [7, 0.008]],
        ["BESI 12 SNI", [10, 0.01]],
        ["BESI 13 ULIR SNI", [13, 0.012]],
        ["BESI 16 ULIR SNI", [19, 0.015]],
        ["BESI 19 ULIR SNI", [27, 0.02]],
        ["TRIPLEKS 9 ML", [9, 0.03]],
        ["TRIPLEKS 6 ML", [6, 0.02]],
        ["TRIPLEKS 3 ML", [3, 0.01]],
        ["KUKU TEHEL", [15, 0.01]],
        ["PAKU", [30, 0.02]],
        ["SKIMKOAT APLUS MERAH", [20, 0.02]],
        ["SKIMKOAT YOSAMI", [20, 0.02]],
        ["CORNICE APLUS", [20, 0.03]],
        ["RAJA PLANK 20 CM", [10, 0.02]],
        ["RAJA PLANK 30 CM", [15, 0.03]],
        ["SOKA JEMPOL", [3, 0.005]],
        ["SOKA APLUS", [2, 0.005]],
        ["NOK SOKA", [1, 0.002]],
        ["HOLLO", [1, 0.01]],
        ["KAWAT BWG 18", [25, 0.02]],
        ["KAWAT BWG NO 12", [50, 0.04]],
        ["PINTU GALVALUM", [8, 0.25]],
        ["PAKU SENG", [16, 0.02]],
        ["SAMBUNGAN PIPA", [8, 0.05]],
        ["RAJA BOARD", [15.5, 0.05]],
        ["GYPSUM", [15, 0.05]],
        ["PIPA 1/2 TRILIUN", [1, 0.01]],
        ["PIPA 3/4 TRILIUN", [1, 0.015]],
        ["PIPA 1 INCI TRILIUN", [1, 0.02]],
        ["PIPA 1 1/4 AW TRILIUN", [2, 0.03]],
        ["PIPA 1 1/2 AW TRILIUN", [2, 0.04]],
        ["PIPA 2 AW TRILIUN", [3, 0.06]],
        ["PIPA 2 1/2 AW TRILIUN", [4, 0.08]],
        ["PIPA 3 AW TRILIUN", [5, 0.10]],
        ["PIPA 4 AW TRILIUN", [9, 0.12]],
        ["PIPA 1 1/4 D TRILIUN", [1, 0.03]],
        ["PIPA 1 1/2 D TRILIUN", [1, 0.04]],
        ["PIPA 2 D TRILIUN", [2, 0.06]],
        ["PIPA 2 1/2 D TRILIUN", [2, 0.08]],
        ["PIPA 3 D TRILIUN", [3, 0.10]],
        ["PIPA 4 D TRILIUN", [5, 0.12]],
        ["TALANG SENG", [16, 0.08]],
        ["BENDRAT", [20, 0.02]],
        ["TANKI 1,200", [21, 1.50]],
        ["KLOSET JONGKOK", [9, 0.08]],
        ["GEROBAK", [20, 0.25]],
        ["SEMEN BOSOWA/TONASA", [50, 0.03]]
    ]);

    const truckData = [
        { name: "Gran Max / Blindvan", ton: 0.7, m3: 2, base: 85000, perKm: 4500 },
        { name: "Pick-up / L300", ton: 1.5, m3: 4, base: 95000, perKm: 5000 },
        { name: "CDE Engkel (4 Roda)", ton: 2.5, m3: 9, base: 240000, perKm: 7000 },
        { name: "CDD Canter / Double", ton: 4.5, m3: 14, base: 450000, perKm: 8500 },
        { name: "CDD Long (Canter Long)", ton: 5.5, m3: 19, base: 550000, perKm: 9500 },
        { name: "Fuso / Tronton", ton: 15.0, m3: 30, base: 1100000, perKm: 15000 },
        { name: "Wingbox / Tronton Long", ton: 20.0, m3: 45, base: 2200000, perKm: 18000 }
    ];
    let rowCount = 0;

    function formatIDR(v) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(v); }

    function addRow() {
        rowCount++;
        const row = document.querySelector('#tonaseTable tbody').insertRow();
        row.id = `row-${rowCount}`;
        row.innerHTML = `
            <td><select class="form-select form-select-sm" onchange="updateRow(${rowCount})">${createOptions()}</select></td>
            <td class="text-center small"><span id="w-${rowCount}">0</span>kg / <span id="v-${rowCount}">0</span>m³</td>
            <td><input type="number" class="form-control form-control-sm text-center" id="qty-${rowCount}" value="0" oninput="updateRow(${rowCount})" disabled></td>
            <td class="text-end fw-bold"><div id="tot-w-${rowCount}">0 kg</div><div class="small text-muted" id="tot-v-${rowCount}">0 m³</div></td>
            <td class="no-print"><button class="btn btn-sm text-danger" onclick="deleteRow(${rowCount})"><i class="fas fa-trash"></i></button></td>
        `;
    }

    function createOptions() {
        let opt = '';
        materials.forEach((v, k) => opt += `<option value="${k}">${k}</option>`);
        return opt;
    }

    function updateRow(idx) {
        const item = document.querySelector(`#row-${idx} select`).value;
        const qtyInp = document.getElementById(`qty-${idx}`);
        const data = materials.get(item) || [0, 0];
        qtyInp.disabled = (data[0] === 0);
        const qty = parseFloat(qtyInp.value) || 0;
        document.getElementById(`w-${idx}`).textContent = data[0];
        document.getElementById(`v-${idx}`).textContent = data[1];
        document.getElementById(`tot-w-${idx}`).textContent = (data[0] * qty).toLocaleString('id-ID') + " kg";
        document.getElementById(`tot-v-${idx}`).textContent = (data[1] * qty).toFixed(2) + " m³";
        calculateTotal();
    }

    function deleteRow(idx) { document.getElementById(`row-${idx}`).remove(); calculateTotal(); }

    function calculateTotal() {
        let tKg = 0; let tM3 = 0;
        document.querySelectorAll('#tonaseTable tbody tr').forEach(row => {
            const item = row.querySelector('select').value;
            const q = parseFloat(row.querySelector('input').value) || 0;
            const data = materials.get(item) || [0, 0];
            tKg += (data[0] * q); tM3 += (data[1] * q);
        });
        const tTon = tKg / 1000;
        document.getElementById('totalTonDisplay').textContent = tTon.toFixed(2);
        document.getElementById('totalM3Display').textContent = tM3.toFixed(2);
        renderAnalysis(tTon, tM3);
    }

    function renderAnalysis(tTon, tM3) {
        const body = document.getElementById('analysisBody');
        const km = parseFloat(document.getElementById('jarakKm').value) || 0;
        const tol = parseFloat(document.getElementById('biayaTol').value) || 0;
        const kuli = parseFloat(document.getElementById('biayaKuli').value) || 0;
        body.innerHTML = '';
        if (tTon === 0 && tM3 === 0) {
            body.innerHTML = '<tr><td colspan="5" class="text-center py-3">Input item untuk simulasi.</td></tr>';
            return;
        }
        truckData.forEach(truck => {
            const tripByTon = Math.ceil(tTon / truck.ton);
            const tripByM3 = Math.ceil(tM3 / truck.m3);
            const totalTrips = Math.max(tripByTon, tripByM3);
            const totalCost = (truck.base + (km * truck.perKm) + tol + kuli) * totalTrips;
            const efficiency = ((tTon / (totalTrips * truck.ton)) * 100).toFixed(0);
            let statusClass = efficiency > 80 ? "status-ideal" : (efficiency > 50 ? "status-warning" : "status-inefficient");
            const row = body.insertRow();
            row.innerHTML = `
                <td class="fw-bold">${truck.name}</td>
                <td class="text-center small">${truck.ton}T / ${truck.m3}m³</td>
                <td class="text-center">${totalTrips}x Trip</td>
                <td class="text-end text-primary fw-bold">${formatIDR(totalCost)}</td>
                <td class="text-center ${statusClass}">${efficiency}% Efisien</td>
            `;
        });
    }

    // --- EKSPOR PDF ---
    function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text("Laporan Estimasi Logistik - Sofyan Mujid", 14, 20);
        doc.setFontSize(10);
        doc.text(`Dicetak: ${new Date().toLocaleString('id-ID')}`, 14, 28);
        doc.autoTable({
            startY: 35,
            head: [['Material', 'Qty', 'Berat', 'Volume']],
            body: Array.from(document.querySelectorAll('#tonaseTable tbody tr')).map(row => [
                row.querySelector('select').value, row.querySelector('input').value,
                row.querySelector('div[id^="tot-w"]').textContent, row.querySelector('div[id^="tot-v"]').textContent
            ])
        });
        doc.autoTable({
            startY: doc.lastAutoTable.finalY + 10,
            head: [['Armada', 'Trip', 'Total Biaya']],
            body: Array.from(document.getElementById('analysisBody').rows).map(row => [
                row.cells[0].innerText, row.cells[2].innerText, row.cells[3].innerText
            ]),
            headStyles: { fillColor: [30, 60, 114] }
        });
        doc.save("Estimasi_Logistik_SofyanMujid.pdf");
    }

    // --- EKSPOR EXCEL ---
    function exportToExcel() {
        const wb = XLSX.utils.book_new();
        const materialData = Array.from(document.querySelectorAll('#tonaseTable tbody tr')).map(row => ({
            Material: row.querySelector('select').value, Qty: row.querySelector('input').value,
            Berat: row.querySelector('div[id^="tot-w"]').textContent, Volume: row.querySelector('div[id^="tot-v"]').textContent
        }));
        const ws = XLSX.utils.json_to_sheet(materialData);
        XLSX.utils.book_append_sheet(wb, ws, "Data Material");
        XLSX.writeFile(wb, "Estimasi_Logistik_SofyanMujid.xlsx");
    }

    function resetCalculator() { if(confirm('Hapus semua?')) { document.querySelector('#tonaseTable tbody').innerHTML = ''; addRow(); calculateTotal(); } }

    addRow();
</script>
</body>
</html>
