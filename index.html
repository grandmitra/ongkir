<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Logistik Pro - Sofyan Mujid</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .header-card { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .result-box { background: #1a1a1a; color: #00d2ff; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; }
        .btn-gmaps { background-color: #4285F4; color: white; font-weight: bold; }
        .table-ongkir thead { background-color: #212529; color: white; font-size: 0.85rem; }
        .cost-detail { font-size: 0.72rem; color: #6c757d; line-height: 1.2; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="header-card text-center">
        <h2><i class="fas fa-calculator me-2"></i> Kalkulator Logistik Material</h2>
        <p>Estimasi Muatan, BBM, Penyusutan & Ongkir Jabodetabek</p>
        <div class="mt-3 no-print">
            <button class="btn btn-danger btn-sm me-2" onclick="exportToPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
            <button class="btn btn-success btn-sm" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Excel</button>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold">Daftar Muatan Barang</h6>
                    <button class="btn btn-sm btn-primary" onclick="addRow()"><i class="fas fa-plus"></i> Item</button>
                </div>
                <div class="table-responsive">
                    <table class="table align-middle mb-0" id="tonaseTable">
                        <thead>
                            <tr class="small text-muted">
                                <th>Material</th>
                                <th class="text-center">Berat/Vol</th>
                                <th class="text-center" style="width: 90px;">Qty</th>
                                <th class="text-end">Total</th>
                                <th class="no-print"></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card p-3 shadow-sm mb-3">
                <h6 class="fw-bold"><i class="fas fa-cog me-2"></i>Parameter Biaya</h6>
                <hr>
                <div class="d-grid mb-3">
                    <a href="https://www.google.com/maps/dir/''/Jl.+Senopati,+Kec.+Kby.+Baru,+Kota+Jakarta+Selatan,+Daerah+Khusus+Ibukota+Jakarta/@-6.1488659,106.671165,27025m/data=!3m1!1e3!4m14!4m13!1m5!1m1!1s0x2e6a03fc6a46f3cd:0x869e7566d672b37e!2m2!1d106.7076702!2d-6.0682105!1m5!1m1!1s0x2e69f15b30d89e2f:0x36d3e4c4cc53ad68!2m2!1d106.8067515!2d-6.2302352!3e0?hl=en-US&entry=ttu&g_ep=EgoyMDI2MDExMy4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D" target="_blank" class="btn btn-gmaps btn-sm">
                        <i class="fas fa-map-marked-alt me-2"></i> CEK JARAK GMAPS
                    </a>
                </div>
                <div class="row g-2">
                    <div class="col-6">
                        <label class="small fw-bold">Jarak (KM):</label>
                        <input type="number" id="jarakKm" class="form-control form-control-sm" value="10" oninput="calculateTotal()">
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold">Harga BBM/L:</label>
                        <input type="number" id="hargaBBM" class="form-control form-control-sm" value="6800" oninput="calculateTotal()">
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold">Tol PP:</label>
                        <input type="number" id="biayaTol" class="form-control form-control-sm" value="0" oninput="calculateTotal()">
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold">Kuli:</label>
                        <input type="number" id="biayaKuli" class="form-control form-control-sm" value="0" oninput="calculateTotal()">
                    </div>
                </div>
                <div class="result-box mt-3">
                    <div class="small text-white opacity-75">Beban Kumulatif:</div>
                    <span id="totalTonDisplay">0.00</span> Ton | <span id="totalM3Display">0.00</span> m続
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mt-2">
        <div class="card-header bg-dark text-white">
            <h6 class="mb-0">Simulasi Biaya Operasional Kendaraan (BOK)</h6>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered align-middle mb-0 table-ongkir">
                <thead class="text-center">
                    <tr>
                        <th>Jenis Armada</th>
                        <th>Trip</th>
                        <th>Estimasi BBM</th>
                        <th>Penyusutan</th>
                        <th>Total Ongkir</th>
                    </tr>
                </thead>
                <tbody id="analysisBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const materials = new Map([
        ["Pilih Item", [0, 0]],
        ["TEHEL 25X25 UNO", [15, 0.02]],
        ["TEHEL 25X25 MASS", [15, 0.02]],
        ["TEHEL 25X40 UNO", [15, 0.02]],
        ["TEHEL 25X40 MASS", [16, 0.02]],
        ["TEHEL 25X50 UNO", [16, 0.02]],
        ["TEHEL 30X60 UNO", [17, 0.03]],
        ["TEHEL 40X40 ARW", [17, 0.02]],
        ["TEHEL 40X40 MASS", [17, 0.02]],
        ["TEHEL 40X40 SPECTRUM", [16, 0.02]],
        ["TEHEL 50X50 LAGUNA", [20, 0.03]],
        ["TEHEL 50X50 UNO", [19, 0.03]],
        ["TEHEL 60X60 MASS", [28, 0.04]],
        ["TEHEL 60X60 UMUM", [30, 0.04]],
        ["GRANIT 60X60 GRACE", [21, 0.04]],
        ["GRANIT 60X60 MOTIF", [28, 0.04]],
        ["GRANIT 80X80", [44, 0.06]],
        ["GRANIT 120X60", [34, 0.05]],
        ["GRANIT 60X60 MAGIA", [32, 0.04]],
        ["GRANIT 60X60 MAGIA2", [28, 0.04]],
        ["TEHEL 20X40", [16, 0.02]],
        ["BESI 6 SNI", [3, 0.005]],
        ["BESI 8 SNI", [5, 0.006]],
        ["BESI 10 SNI", [7, 0.008]],
        ["BESI 12 SNI", [10, 0.01]],
        ["BESI 13 ULIR SNI", [13, 0.012]],
        ["BESI 16 ULIR SNI", [19, 0.015]],
        ["BESI 19 ULIR SNI", [27, 0.02]],
        ["TRIPLEKS 9 ML", [9, 0.03]],
        ["TRIPLEKS 6 ML", [6, 0.02]],
        ["TRIPLEKS 3 ML", [3, 0.01]],
        ["KUKU TEHEL", [15, 0.01]],
        ["PAKU", [30, 0.02]],
        ["SKIMKOAT APLUS MERAH", [20, 0.02]],
        ["SKIMKOAT YOSAMI", [20, 0.02]],
        ["CORNICE APLUS", [20, 0.03]],
        ["RAJA PLANK 20 CM", [10, 0.02]],
        ["RAJA PLANK 30 CM", [15, 0.03]],
        ["SOKA JEMPOL", [3, 0.005]],
        ["SOKA APLUS", [2, 0.005]],
        ["NOK SOKA", [1, 0.002]],
        ["HOLLO", [1, 0.01]],
        ["KAWAT BWG 18", [25, 0.02]],
        ["KAWAT BWG NO 12", [50, 0.04]],
        ["PINTU GALVALUM", [8, 0.25]],
        ["PAKU SENG", [16, 0.02]],
        ["SAMBUNGAN PIPA", [8, 0.05]],
        ["RAJA BOARD", [15.5, 0.05]],
        ["GYPSUM", [15, 0.05]],
        ["PIPA 1/2 TRILIUN", [1, 0.01]],
        ["PIPA 3/4 TRILIUN", [1, 0.015]],
        ["PIPA 1 INCI TRILIUN", [1, 0.02]],
        ["PIPA 1 1/4 AW TRILIUN", [2, 0.03]],
        ["PIPA 1 1/2 AW TRILIUN", [2, 0.04]],
        ["PIPA 2 AW TRILIUN", [3, 0.06]],
        ["PIPA 2 1/2 AW TRILIUN", [4, 0.08]],
        ["PIPA 3 AW TRILIUN", [5, 0.10]],
        ["PIPA 4 AW TRILIUN", [9, 0.12]],
        ["PIPA 1 1/4 D TRILIUN", [1, 0.03]],
        ["PIPA 1 1/2 D TRILIUN", [1, 0.04]],
        ["PIPA 2 D TRILIUN", [2, 0.06]],
        ["PIPA 2 1/2 D TRILIUN", [2, 0.08]],
        ["PIPA 3 D TRILIUN", [3, 0.10]],
        ["PIPA 4 D TRILIUN", [5, 0.12]],
        ["TALANG SENG", [16, 0.08]],
        ["BENDRAT", [20, 0.02]],
        ["TANKI 1,200", [21, 1.50]],
        ["KLOSET JONGKOK", [9, 0.08]],
        ["GEROBAK", [20, 0.25]],
        ["SEMEN", [50, 0.03]]
    ]);

    // DATA TRUCK DENGAN FUEL RATE (L/KM) DAN WEAR (RP/KM)
    const truckData = [
        { name: "Gran Max / Blindvan", ton: 0.7, m3: 2, base: 85000, perKm: 4500, fuelRate: 0.08, wear: 300 },
        { name: "Pick-up Bak / L300", ton: 1.5, m3: 4, base: 95000, perKm: 5000, fuelRate: 0.10, wear: 450 },
        { name: "Pick-up Box", ton: 1.2, m3: 6, base: 110000, perKm: 5500, fuelRate: 0.11, wear: 480 },
        { name: "CDE Engkel Bak", ton: 2.5, m3: 9, base: 240000, perKm: 7000, fuelRate: 0.14, wear: 800 },
        { name: "CDE Engkel Box", ton: 2.2, m3: 10, base: 260000, perKm: 7500, fuelRate: 0.15, wear: 850 },
        { name: "CDD Canter Double", ton: 4.5, m3: 14, base: 450000, perKm: 8500, fuelRate: 0.18, wear: 1200 },
        { name: "CDD Long (Canter)", ton: 5.5, m3: 19, base: 550000, perKm: 9500, fuelRate: 0.20, wear: 1400 },
        { name: "Fuso Engkel", ton: 8.0, m3: 24, base: 850000, perKm: 12000, fuelRate: 0.28, wear: 2000 },
        { name: "Fuso Tronton", ton: 15.0, m3: 30, base: 1200000, perKm: 15000, fuelRate: 0.35, wear: 3000 },
        { name: "Wingbox", ton: 20.0, m3: 45, base: 2200000, perKm: 18000, fuelRate: 0.40, wear: 4000 },
        { name: "Trailer 20 Feet", ton: 20.0, m3: 33, base: 2500000, perKm: 20000, fuelRate: 0.45, wear: 5000 },
        { name: "Trailer 40 Feet", ton: 30.0, m3: 60, base: 3500000, perKm: 25000, fuelRate: 0.55, wear: 6500 }
    ];

    let rowCount = 0;
    function formatIDR(v) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(v); }

    function addRow() {
        rowCount++;
        const row = document.querySelector('#tonaseTable tbody').insertRow();
        row.innerHTML = `
            <td><select class="form-select form-select-sm" onchange="updateRow(this)">${createOptions()}</select></td>
            <td class="text-center small"><span>0</span>kg</td>
            <td><input type="number" class="form-control form-control-sm text-center" value="0" oninput="updateRow(this)" disabled></td>
            <td class="text-end fw-bold small">0 kg</td>
            <td class="no-print"><button class="btn btn-sm text-danger" onclick="this.parentElement.parentElement.remove();calculateTotal()"><i class="fas fa-trash"></i></button></td>
        `;
    }

    function createOptions() {
        let opt = ''; materials.forEach((v, k) => opt += `<option value="${k}">${k}</option>`); return opt;
    }

    function updateRow(el) {
        const row = el.closest('tr');
        const item = row.querySelector('select').value;
        const qtyInp = row.querySelector('input');
        const data = materials.get(item) || [0, 0];
        qtyInp.disabled = (data[0] === 0);
        const qty = parseFloat(qtyInp.value) || 0;
        row.cells[1].innerHTML = `${data[0]}kg / ${data[1]}m続`;
        row.cells[3].innerHTML = `<div>${(data[0]*qty).toLocaleString()} kg</div><div class="small text-muted">${(data[1]*qty).toFixed(2)} m続</div>`;
        calculateTotal();
    }

    function calculateTotal() {
        let tKg = 0, tM3 = 0;
        document.querySelectorAll('#tonaseTable tbody tr').forEach(row => {
            const item = row.querySelector('select').value;
            const q = parseFloat(row.querySelector('input').value) || 0;
            const data = materials.get(item) || [0, 0];
            tKg += (data[0] * q); tM3 += (data[1] * q);
        });
        const tTon = tKg / 1000;
        document.getElementById('totalTonDisplay').textContent = tTon.toFixed(2);
        document.getElementById('totalM3Display').textContent = tM3.toFixed(2);
        renderAnalysis(tTon, tM3);
    }

    function renderAnalysis(tTon, tM3) {
        const body = document.getElementById('analysisBody');
        const km = parseFloat(document.getElementById('jarakKm').value) || 0;
        const hargaBbmInput = parseFloat(document.getElementById('hargaBBM').value) || 0;
        const tol = parseFloat(document.getElementById('biayaTol').value) || 0;
        const kuli = parseFloat(document.getElementById('biayaKuli').value) || 0;
        body.innerHTML = '';

        truckData.forEach(truck => {
            const trip = Math.max(Math.ceil(tTon / truck.ton), Math.ceil(tM3 / truck.m3)) || 0;
            if (trip === 0) return;

            // FAKTOR BEBAN: Jika muatan berat (>70% kapasitas), BBM boros 20%
            const loadFactor = (tTon / (trip * truck.ton)) > 0.7 ? 1.2 : 1.0;
            const bbmLiters = (km * truck.fuelRate * 2) * trip * loadFactor; // *2 untuk PP
            const biayaBBM = bbmLiters * hargaBbmInput;
            const biayaSusut = (km * 2 * truck.wear) * trip; // *2 untuk PP
            
            // TOTAL ONGKIR = Biaya Jarak + Tol + Kuli (BBM & Susut sudah bagian dari biaya operasional)
            const totalOngkir = ((truck.base + (km * truck.perKm)) * trip) + tol + kuli;

            const row = body.insertRow();
            row.innerHTML = `
                <td>
                    <div class="fw-bold small">${truck.name}</div>
                    <div class="cost-detail">Cap: ${truck.ton}T / ${truck.m3}m続</div>
                </td>
                <td class="text-center">${trip}x</td>
                <td class="text-end">
                    <div class="small">${formatIDR(biayaBBM)}</div>
                    <div class="cost-detail">~${bbmLiters.toFixed(1)} L (PP)</div>
                </td>
                <td class="text-end">
                    <div class="small">${formatIDR(biayaSusut)}</div>
                    <div class="cost-detail">Ban & Servis</div>
                </td>
                <td class="text-end">
                    <div class="text-primary fw-bold small">${formatIDR(totalOngkir)}</div>
                    <div class="cost-detail">Inc. Jarak+Tol+Kuli</div>
                </td>
            `;
        });
    }

    function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("Laporan Logistik - Sofyan Mujid", 14, 15);
        doc.autoTable({ html: '#tonaseTable', startY: 25 });
        doc.save("Logistik_Report.pdf");
    }

    function exportToExcel() {
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.table_to_sheet(document.getElementById('tonaseTable'));
        XLSX.utils.book_append_sheet(wb, ws, "Material");
        XLSX.writeFile(wb, "Logistik_Data.xlsx");
    }

    addRow();
</script>
</body>
</html>
