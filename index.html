<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Logistik Material Pro - Sofyan Mujid</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .header-card { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .card { border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .result-box { background: #212529; color: #ffc107; padding: 15px; border-radius: 10px; font-weight: bold; text-align: center; }
        .table-ongkir thead { background-color: #2c3e50; color: white; }
        .status-ideal { color: #198754; font-weight: bold; }
        .status-warning { color: #fd7e14; font-weight: bold; }
        .status-inefficient { color: #dc3545; font-weight: bold; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="header-card text-center">
        <h1><i class="fas fa-shipping-fast me-3"></i>Kalkulator Logistik Material</h1>
        <p>Estimasi Tonase, Kubikasi & Ongkir Jabodetabek (Titik Awal: PIK 2)</p>
        <div class="mt-2">
            <a href="https://www.google.com/maps?ll=-6.06821,106.70767&z=16&t=h&hl=en-US&gl=US&mapclient=embed&cid=9700319731947582334" target="_blank" class="btn btn-sm btn-light text-primary fw-bold">
                <i class="fas fa-map-marker-alt"></i> Cek Jarak dari PIK 2
            </a>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-dark">Daftar Muatan Barang</h5>
                    <div class="no-print">
                        <button class="btn btn-sm btn-outline-danger" onclick="resetCalculator()"><i class="fas fa-sync"></i> Reset</button>
                        <button class="btn btn-sm btn-primary" onclick="addRow()"><i class="fas fa-plus"></i> Tambah</button>
                    </div>
                </div>
                <div class="table-responsive" style="max-height: 450px;">
                    <table class="table table-hover align-middle mb-0" id="tonaseTable">
                        <thead class="table-light">
                            <tr>
                                <th>No</th>
                                <th>Item Material</th>
                                <th class="text-center">Berat(kg) / Vol(m³)</th>
                                <th class="text-center" style="width: 100px;">Qty</th>
                                <th class="text-end">Total Beban</th>
                                <th class="no-print"></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm p-3 mb-3">
                <h6 class="fw-bold"><i class="fas fa-route me-2"></i>Parameter Ongkir</h6>
                <hr>
                <div class="mb-3">
                    <label class="form-label small">Estimasi Jarak (KM):</label>
                    <input type="number" id="jarakKm" class="form-control" value="10" oninput="calculateTotal()">
                    <small class="text-muted">Jkt: 15km | Tgr: 25km | Bgr: 65km</small>
                </div>
                <div class="mb-3">
                    <label class="form-label small">Biaya Tol PP (Rp):</label>
                    <input type="number" id="biayaTol" class="form-control" value="0" oninput="calculateTotal()">
                </div>
                <div class="mb-3">
                    <label class="form-label small">Kuli Bongkar (Rp):</label>
                    <input type="number" id="biayaKuli" class="form-control" value="0" oninput="calculateTotal()">
                </div>
                <div class="result-box">
                    <div class="small text-white">Total Muatan:</div>
                    <span id="totalTonDisplay">0.00</span> Ton | <span id="totalM3Display">0.00</span> m³
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0 mt-2">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0"><i class="fas fa-calculator me-2"></i>Simulasi Kendaraan & Estimasi Ongkir</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered align-middle table-ongkir">
                    <thead>
                        <tr class="text-center">
                            <th>Jenis Armada</th>
                            <th>Kapasitas (T/m³)</th>
                            <th>Jml Trip</th>
                            <th>Total Ongkir (Jarak + Tol + Kuli)</th>
                            <th>Efisiensi</th>
                        </tr>
                    </thead>
                    <tbody id="analysisBody"></tbody>
                </table>
            </div>
            <div class="alert alert-secondary small mt-3">
                <strong>Catatan:</strong> Tarif mengacu pada rata-rata Lalamove/Deliveree Jabodetabek. Perhitungan trip didasarkan pada mana yang lebih dulu mencapai batas maksimal (Berat atau Kubikasi)[cite: 66, 70].
            </div>
        </div>
    </div>
</div>

<footer class="text-center mt-5 mb-4 text-muted small">
    © 2026 Kalkulator Logistik Material - PIK 2 Jakarta • Sofyan Mujid
</footer>

<script>
    // Data Material: [Berat(kg), Kubikasi(m3)]
    const materials = new Map([
        ["Pilih Item", [0, 0]],
        ["TEHEL 60X60 UMUM", [30, 0.04]],
        ["SEMEN BOSOWA/TONASA", [50, 0.03]],
        ["BESI 10 SNI", [7, 0.01]],
        ["BESI 12 SNI", [10, 0.01]],
        ["GRANIT 80X80", [44, 0.06]],
        ["TANKI AIR 1200L", [21, 1.50]], // Barang volume besar
        ["PIPA 4 AW TRILIUN", [9, 0.12]],
        ["KLOSET JONGKOK", [9, 0.08]],
        ["TRIPLEKS 9 ML", [9, 0.05]]
    ]);

    // Data Armada: [Kapasitas Ton, Kapasitas m3, Tarif Dasar, Biaya per KM]
    const truckData = [
        { name: "Pick-up / L300", ton: 1.5, m3: 4, base: 95000, perKm: 5000 },
        { name: "CDE Engkel", ton: 2.5, m3: 9, base: 240000, perKm: 7000 },
        { name: "CDD Double", ton: 4.5, m3: 14, base: 450000, perKm: 8500 },
        { name: "Fuso / Tronton", ton: 15.0, m3: 30, base: 1100000, perKm: 15000 }
    ];

    let rowCount = 0;
    const tableBody = document.querySelector('#tonaseTable tbody');

    function formatIDR(num) {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);
    }

    function addRow() {
        rowCount++;
        const row = tableBody.insertRow();
        row.id = `row-${rowCount}`;
        row.innerHTML = `
            <td>${rowCount}</td>
            <td><select class="form-select form-select-sm" onchange="updateRow(${rowCount})">${createOptions()}</select></td>
            <td class="text-center small">
                <span id="w-val-${rowCount}">0</span> kg / <span id="v-val-${rowCount}">0</span> m³
            </td>
            <td><input type="number" class="form-control form-control-sm text-center" id="qty-${rowCount}" value="0" min="0" oninput="updateRow(${rowCount})" disabled></td>
            <td class="text-end fw-bold">
                <div id="tot-w-${rowCount}">0 kg</div>
                <div class="small text-muted" id="tot-v-${rowCount}">0 m³</div>
            </td>
            <td class="no-print"><button class="btn btn-sm btn-link text-danger" onclick="deleteRow(${rowCount})"><i class="fas fa-trash"></i></button></td>
        `;
    }

    function createOptions() {
        let opt = '';
        materials.forEach((v, k) => opt += `<option value="${k}">${k}</option>`);
        return opt;
    }

    function updateRow(idx) {
        const item = document.querySelector(`#row-${idx} select`).value;
        const qtyInp = document.getElementById(`qty-${idx}`);
        const data = materials.get(item) || [0, 0];
        
        qtyInp.disabled = (data[0] === 0);
        const qty = parseFloat(qtyInp.value) || 0;
        
        document.getElementById(`w-val-${idx}`).textContent = data[0];
        document.getElementById(`v-val-${idx}`).textContent = data[1];
        document.getElementById(`tot-w-${idx}`).textContent = (data[0] * qty).toLocaleString('id-ID') + " kg";
        document.getElementById(`tot-v-${idx}`).textContent = (data[1] * qty).toFixed(2) + " m³";
        calculateTotal();
    }

    function deleteRow(idx) { document.getElementById(`row-${idx}`).remove(); calculateTotal(); }

    function calculateTotal() {
        let tKg = 0; let tM3 = 0;
        document.querySelectorAll('#tonaseTable tbody tr').forEach(row => {
            const item = row.querySelector('select').value;
            const qty = parseFloat(row.querySelector('input').value) || 0;
            const data = materials.get(item) || [0, 0];
            tKg += (data[0] * qty);
            tM3 += (data[1] * qty);
        });

        const tTon = tKg / 1000;
        document.getElementById('totalTonDisplay').textContent = tTon.toFixed(2);
        document.getElementById('totalM3Display').textContent = tM3.toFixed(2);
        
        renderAnalysis(tTon, tM3);
    }

    function renderAnalysis(tTon, tM3) {
        const body = document.getElementById('analysisBody');
        const km = parseFloat(document.getElementById('jarakKm').value) || 0;
        const tol = parseFloat(document.getElementById('biayaTol').value) || 0;
        const kuli = parseFloat(document.getElementById('biayaKuli').value) || 0;
        body.innerHTML = '';

        if (tTon === 0 && tM3 === 0) {
            body.innerHTML = '<tr><td colspan="5" class="text-center py-3 text-muted">Input barang untuk melihat ongkir.</td></tr>';
            return;
        }

        truckData.forEach(truck => {
            const tripByTon = Math.ceil(tTon / truck.ton);
            const tripByM3 = Math.ceil(tM3 / truck.m3);
            const totalTrips = Math.max(tripByTon, tripByM3);
            
            const baseOngkir = truck.base + (km * truck.perKm);
            const totalCost = (baseOngkir + tol + kuli) * totalTrips;
            
            const efficiency = ((tTon / (totalTrips * truck.ton)) * 100).toFixed(0);
            let statusClass = efficiency > 80 ? "status-ideal" : (efficiency > 50 ? "status-warning" : "status-inefficient");

            const row = body.insertRow();
            row.innerHTML = `
                <td><strong>${truck.name}</strong></td>
                <td class="text-center small">${truck.ton}T / ${truck.m3}m³</td>
                <td class="text-center">${totalTrips}x Trip</td>
                <td class="text-end fw-bold text-primary">${formatIDR(totalCost)}</td>
                <td class="text-center ${statusClass}">${efficiency}% Efisien</td>
            `;
        });
    }

    function resetCalculator() {
        if(confirm('Reset semua data?')) {
            tableBody.innerHTML = '';
            rowCount = 0;
            addRow();
            calculateTotal();
        }
    }

    addRow();
</script>
</body>
</html>
