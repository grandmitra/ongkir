<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Tonase & Logistik - Sofyan Mujid</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .header-card { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .result-box { background: #1a1a1a; color: #00d2ff; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; }
        .table thead { background-color: #212529; color: white; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="header-card text-center">
        <img src="https://grandmitra.com/wp-content/uploads/2024/09/gm-1536x328.png" alt="Logo" style="max-height: 60px; margin-bottom: 15px;">
        <h2><i class="fas fa-truck-moving me-2"></i> Kalkulator Tonase & Logistik</h2>
        <p>Analisis Efisiensi Muatan & Biaya Operasional</p>
        <div class="mt-3 no-print">
            <button class="btn btn-danger btn-sm me-2" onclick="exportToPDF()"><i class="fas fa-file-pdf"></i> Ekspor PDF</button>
            <button class="btn btn-success btn-sm" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Ekspor Excel</button>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-white d-flex justify-content-between align-items-center p-3">
            <h6 class="mb-0 fw-bold">Daftar Material Muatan</h6>
            <button class="btn btn-sm btn-primary" onclick="addRow()"><i class="fas fa-plus"></i> Tambah Item</button>
        </div>
        <div class="table-responsive">
            <table class="table align-middle mb-0" id="tonaseTable">
                <thead>
                    <tr class="small">
                        <th style="width: 5%;">No</th>
                        <th style="width: 40%;">Nama Material</th>
                        <th class="text-center">Berat/Vol Satuan</th>
                        <th class="text-center" style="width: 100px;">Qty</th>
                        <th class="text-end">Total Kumulatif</th>
                        <th class="no-print"></th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-md-6">
            <div class="result-box bg-dark">
                <span class="small opacity-75">Total Berat:</span><br>
                <span id="totalKgDisplay">0</span> kg
            </div>
        </div>
        <div class="col-md-6">
            <div class="result-box bg-primary text-white">
                <span class="small opacity-75">Total Tonase:</span><br>
                <span id="totalTonDisplay">0.00</span> Ton
            </div>
        </div>
    </div>

    <div class="card mt-4 shadow-sm" id="analysisSection">
        <div class="card-header bg-info text-white fw-bold">Analisis Daya Angkut Kendaraan</div>
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Jenis Armada</th>
                        <th class="text-center">Kapasitas (Ton)</th>
                        <th class="text-center">Estimasi Trip</th>
                        <th>Rekomendasi Efisiensi</th>
                    </tr>
                </thead>
                <tbody id="analysisBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
   // Data Material: [Berat (kg), Volume (m3)]
    const materials = new Map([
        ["Pilih Item", [0, 0]],
        ["TEHEL 25X25 UNO", [15, 0.02]],
        ["TEHEL 25X25 MASS", [15, 0.02]],
        ["TEHEL 25X40 UNO", [15, 0.02]],
        ["TEHEL 25X40 MASS", [16, 0.02]],
        ["TEHEL 25X50 UNO", [16, 0.02]],
        ["TEHEL 30X60 UNO", [17, 0.03]],
        ["TEHEL 40X40 ARW", [17, 0.02]],
        ["TEHEL 40X40 MASS", [17, 0.02]],
        ["TEHEL 40X40 SPECTRUM", [16, 0.02]],
        ["TEHEL 50X50 LAGUNA", [20, 0.03]],
        ["TEHEL 50X50 UNO", [19, 0.03]],
        ["TEHEL 60X60 MASS", [28, 0.04]],
        ["TEHEL 60X60 UMUM", [30, 0.04]],
        ["GRANIT 60X60 GRACE", [21, 0.04]],
        ["GRANIT 60X60 MOTIF", [28, 0.04]],
        ["GRANIT 80X80", [44, 0.06]],
        ["GRANIT 120X60", [34, 0.05]],
        ["GRANIT 60X60 MAGIA", [32, 0.04]],
        ["GRANIT 60X60 MAGIA2", [28, 0.04]],
        ["TEHEL 20X40", [16, 0.02]],
        ["BESI 6 SNI", [3, 0.005]],
        ["BESI 8 SNI", [5, 0.006]],
        ["BESI 10 SNI", [7, 0.008]],
        ["BESI 12 SNI", [10, 0.01]],
        ["BESI 13 ULIR SNI", [13, 0.012]],
        ["BESI 16 ULIR SNI", [19, 0.015]],
        ["BESI 19 ULIR SNI", [27, 0.02]],
        ["TRIPLEKS 9 ML", [9, 0.03]],
        ["TRIPLEKS 6 ML", [6, 0.02]],
        ["TRIPLEKS 3 ML", [3, 0.01]],
        ["KUKU TEHEL", [15, 0.01]],
        ["PAKU", [30, 0.02]],
        ["SKIMKOAT APLUS MERAH", [20, 0.02]],
        ["SKIMKOAT YOSAMI", [20, 0.02]],
        ["CORNICE APLUS", [20, 0.03]],
        ["RAJA PLANK 20 CM", [10, 0.02]],
        ["RAJA PLANK 30 CM", [15, 0.03]],
        ["SOKA JEMPOL", [3, 0.005]],
        ["SOKA APLUS", [2, 0.005]],
        ["NOK SOKA", [1, 0.002]],
        ["HOLLO", [1, 0.01]],
        ["KAWAT BWG 18", [25, 0.02]],
        ["KAWAT BWG NO 12", [50, 0.04]],
        ["PINTU GALVALUM", [8, 0.25]],
        ["PAKU SENG", [16, 0.02]],
        ["SAMBUNGAN PIPA", [8, 0.05]],
        ["RAJA BOARD", [15.5, 0.05]],
        ["GYPSUM", [15, 0.05]],
        ["PIPA 1/2 TRILIUN", [1, 0.01]],
        ["PIPA 3/4 TRILIUN", [1, 0.015]],
        ["PIPA 1 INCI TRILIUN", [1, 0.02]],
        ["PIPA 1 1/4 AW TRILIUN", [2, 0.03]],
        ["PIPA 1 1/2 AW TRILIUN", [2, 0.04]],
        ["PIPA 2 AW TRILIUN", [3, 0.06]],
        ["PIPA 2 1/2 AW TRILIUN", [4, 0.08]],
        ["PIPA 3 AW TRILIUN", [5, 0.10]],
        ["PIPA 4 AW TRILIUN", [9, 0.12]],
        ["PIPA 1 1/4 D TRILIUN", [1, 0.03]],
        ["PIPA 1 1/2 D TRILIUN", [1, 0.04]],
        ["PIPA 2 D TRILIUN", [2, 0.06]],
        ["PIPA 2 1/2 D TRILIUN", [2, 0.08]],
        ["PIPA 3 D TRILIUN", [3, 0.10]],
        ["PIPA 4 D TRILIUN", [5, 0.12]],
        ["TALANG SENG", [16, 0.08]],
        ["BENDRAT", [20, 0.02]],
        ["TANKI 1,200", [21, 1.50]],
        ["KLOSET JONGKOK", [9, 0.08]],
        ["GEROBAK", [20, 0.25]],
        ["SEMEN", [50, 0.03]]
    ]);

    // Data Truck: [ton, m3, base_price, price_per_km, fuel_rate, wear_cost]
    const truckData = [
        { name: "Gran Max / Blindvan", ton: 0.7, m3: 2, base: 85000, perKm: 4500, fuelRate: 0.08, wear: 300 },
        { name: "Pick-up Bak / L300", ton: 1.5, m3: 4, base: 95000, perKm: 5000, fuelRate: 0.10, wear: 450 },
        { name: "Pick-up Box", ton: 1.2, m3: 6, base: 110000, perKm: 5500, fuelRate: 0.11, wear: 480 },
        { name: "CDE Engkel Bak", ton: 2.5, m3: 9, base: 240000, perKm: 7000, fuelRate: 0.14, wear: 800 },
        { name: "CDE Engkel Box", ton: 2.2, m3: 10, base: 260000, perKm: 7500, fuelRate: 0.15, wear: 850 },
        { name: "CDD Canter Double", ton: 4.5, m3: 14, base: 450000, perKm: 8500, fuelRate: 0.18, wear: 1200 },
        { name: "CDD Long (Canter)", ton: 5.5, m3: 19, base: 550000, perKm: 9500, fuelRate: 0.20, wear: 1400 },
        { name: "Fuso Engkel", ton: 8.0, m3: 24, base: 850000, perKm: 12000, fuelRate: 0.28, wear: 2000 },
        { name: "Fuso Tronton", ton: 15.0, m3: 30, base: 1200000, perKm: 15000, fuelRate: 0.35, wear: 3000 },
        { name: "Wingbox", ton: 20.0, m3: 45, base: 2200000, perKm: 18000, fuelRate: 0.40, wear: 4000 },
        { name: "Trailer 20 Feet", ton: 20.0, m3: 33, base: 2500000, perKm: 20000, fuelRate: 0.45, wear: 5000 },
        { name: "Trailer 40 Feet", ton: 30.0, m3: 60, base: 3500000, perKm: 25000, fuelRate: 0.55, wear: 6500 }
    ];

    function addRow() {
        const tbody = document.getElementById('tableBody');
        const rowCount = tbody.rows.length + 1;
        const row = tbody.insertRow();
        row.innerHTML = `
            <td>${rowCount}</td>
            <td><select class="form-select form-select-sm item-select" onchange="updateRow(this)">${Array.from(materials.keys()).map(m => `<option value="${m}">${m}</option>`).join('')}</select></td>
            <td class="text-center small item-info">-</td>
            <td><input type="number" class="form-control form-control-sm text-center quantity-input" value="0" min="0" oninput="updateRow(this)" disabled></td>
            <td class="text-end fw-bold total-info">0 kg</td>
            <td class="no-print"><button class="btn btn-sm text-danger" onclick="this.parentElement.parentElement.remove();calculateTotal()"><i class="fas fa-trash"></i></button></td>
        `;
    }

    function updateRow(el) {
        const row = el.closest('tr');
        const item = row.querySelector('.item-select').value;
        const qtyInput = row.querySelector('.quantity-input');
        const data = materials.get(item) || [0, 0];
        
        qtyInput.disabled = (data[0] === 0);
        const qty = parseFloat(qtyInput.value) || 0;
        
        row.querySelector('.item-info').innerHTML = `${data[0]}kg / ${data[1]}m³`;
        row.querySelector('.total-info').innerHTML = `<div>${(data[0]*qty).toLocaleString('id-ID')} kg</div><div class="small text-muted">${(data[1]*qty).toFixed(2)} m³</div>`;
        calculateTotal();
    }

    function calculateTotal() {
        let totalKg = 0;
        document.querySelectorAll('#tableBody tr').forEach(row => {
            const item = row.querySelector('.item-select').value;
            const qty = parseFloat(row.querySelector('.quantity-input').value) || 0;
            const data = materials.get(item) || [0, 0];
            totalKg += (data[0] * qty);
        });
        
        const totalTon = totalKg / 1000;
        document.getElementById('totalKgDisplay').textContent = totalKg.toLocaleString('id-ID');
        document.getElementById('totalTonDisplay').textContent = totalTon.toFixed(2);
        
        renderAnalysis(totalTon);
    }

    function renderAnalysis(totalTon) {
        const body = document.getElementById('analysisBody');
        body.innerHTML = '';
        if (totalTon === 0) return;

        truckCapacities.forEach(truck => {
            const trips = Math.ceil(totalTon / truck.cap);
            const efficiency = ((totalTon / (trips * truck.cap)) * 100).toFixed(0);
            
            const row = body.insertRow();
            row.innerHTML = `
                <td>${truck.name}</td>
                <td class="text-center">${truck.cap} Ton</td>
                <td class="text-center">${trips}x Trip</td>
                <td><span class="badge ${efficiency > 80 ? 'bg-success' : 'bg-warning'}">${efficiency}% Efisien</span></td>
            `;
        });
    }

    async function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        
        // Load Logo Perusahaan
        const logoUrl = "https://grandmitra.com/wp-content/uploads/2024/09/gm-1536x328.png";
        try {
            doc.addImage(logoUrl, 'PNG', 14, 10, 50, 11);
        } catch (e) { console.error("Logo failed to load"); }

        doc.setFontSize(16);
        doc.text("LAPORAN ANALISIS LOGISTIK", 14, 30);
        doc.setFontSize(10);
        doc.text("Tanggal: " + new Date().toLocaleDateString('id-ID'), 14, 37);

        // Data Tabel Material (Hanya yang dipilih)
        const tableData = [];
        document.querySelectorAll('#tableBody tr').forEach((row, i) => {
            const material = row.querySelector('.item-select').value;
            const qty = row.querySelector('.quantity-input').value;
            if(material !== "Pilih Item" && qty > 0) {
                tableData.push([i+1, material, row.querySelector('.item-info').textContent, qty, row.querySelector('.total-info').textContent.replace(/\n/g, ' ')]);
            }
        });

        doc.autoTable({
            startY: 45,
            head: [['No', 'Material', 'Berat/Vol Satuan', 'Qty', 'Total Kumulatif']],
            body: tableData,
            theme: 'striped',
            headStyles: { fillColor: [30, 82, 152] }
        });

        // Ringkasan
        const finalY = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(12);
        doc.text(`TOTAL TONASE: ${document.getElementById('totalTonDisplay').textContent} Ton`, 14, finalY);

        doc.save("Laporan_Logistik_GrandMitra.pdf");
    }

    function exportToExcel() {
        const data = [["LAPORAN LOGISTIK"], ["Material", "Berat Satuan", "Vol Satuan", "Qty", "Total Berat", "Total Vol"]];
        document.querySelectorAll('#tableBody tr').forEach(row => {
            const item = row.querySelector('.item-select').value;
            const qty = parseFloat(row.querySelector('.quantity-input').value) || 0;
            const m = materials.get(item);
            if(qty > 0) data.push([item, m[0], m[1], qty, m[0]*qty, m[1]*qty]);
        });

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, ws, "Laporan");
        XLSX.writeFile(wb, "Laporan_GrandMitra.xlsx");
    }

    addRow();
</script>
</body>
</html>
